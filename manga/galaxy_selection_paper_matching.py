import os
import numpy as np
from astropy.io import fits
import matplotlib.pyplot as plt
from matplotlib import cm
import matplotlib.colors as colors
from matplotlib.backends.backend_pdf import PdfPages
import glob
from astropy.cosmology import FlatLambdaCDM
import astropy.units as u
from PyPDF2 import PdfFileMerger
import copy
from copy import deepcopy
from os.path import isdir, join
import math


mpl5_dir = os.environ['MANGADIR_MPL5']
drp = fits.open(mpl5_dir+'drpall-v2_0_1.fits')
drpdata = drp[1].data
absmag = drpdata.field('nsa_elpetro_absmag')

ifu_l = drpdata.field('plateifu')
ifu_list = list(ifu_l)

manga_id = drpdata.field('mangaid')
mangaid = list(manga_id)


good_galxies = [[8262, 1902, 1.2380620297469431, 6], [8597, 6104, 1.2339423537754584, 14], [8987, 1901, 1.0405619373189734, 5], [7975, 9102, 0.94207652187996993, 16], [8313, 1901, 0.87610030276181694, 5], [8082, 3701, 0.82404316225203966, 7], [8325, 3701, 0.81377880208120568, 7], [7990, 12703, 0.76183285172580029, 2], [8081, 1901, 0.75668569935436836, 5], [8132, 9101, 0.72775674210016394, 15], [8465, 9101, 0.72703904475936965, 15], [8249, 1901, 0.72413077462329156, 5], [8318, 12702, 0.68223025124789782, 1], [8711, 1902, 0.67447785224117618, 6], [8485, 6103, 0.64804992508574988, 13], [7977, 12704, 0.64478325464597885, 3], [8552, 12702, 0.63332802500860841, 1], [8077, 6102, 0.61166555745912632, 12], [8455, 12705, 0.60665902350021139, 4], [8606, 9102, 0.60095230121318499, 16], [8335, 3704, 0.5921413295274518, 10], [8082, 3702, 0.55895498851102443, 8], [8601, 9101, 0.55708210155470717, 15], [7495, 3702, 0.55397262756957333, 8], [8456, 12702, 0.54878300427726157, 1], [8462, 9102, 0.54659457408426393, 16], [8333, 12703, 0.54564785156918072, 2], [8332, 9102, 0.53994760038850864, 16], [8263, 12701, 0.52385177250381487, 0], [8712, 6103, 0.5222240329778487, 13], [10001, 12704, 0.51866549790105843, 3], [8325, 12702, 0.51780380431022655, 1], [8552, 12701, 0.51443301465537905, 0], [8145, 12701, 0.51000653250695349, 0], [8341, 3702, 0.50556577847344275, 8], [8241, 12703, 0.50072291672206792, 2], [8250, 12705, 0.49687045905805932, 4], [8551, 3701, 0.49274267322591198, 7], [8466, 9102, 0.49219758380982226, 16], [8341, 6102, 0.49134950015833856, 12], [8713, 12703, 0.46926664022890985, 2], [8548, 12704, 0.46613522145060393, 3], [8145, 1902, 0.45785589001837146, 6], [8946, 3702, 0.45166970013429186, 8], [8458, 3701, 0.44909872031265419, 7], [8623, 12702, 0.44645541008106382, 1], [8320, 12703, 0.44334656699529668, 2], [8440, 6102, 0.4406229238036044, 12], [8448, 12704, 0.41875562524863841, 3], [7992, 12703, 0.41691579663955919, 2], [8943, 1901, 0.41668537719354126, 5], [8604, 12702, 0.41536295049237021, 1], [8132, 3702, 0.40979483311293313, 8], [8719, 9102, 0.4058148608155791, 16], [8149, 12703, 0.40352727567485019, 2], [8320, 3702, 0.40350785310729842, 8], [8616, 12705, 0.40216556404162851, 4], [8612, 12704, 0.40119415451056462, 3], [8082, 12703, 0.39749885964028359, 2], [8549, 12704, 0.39563819051111127, 3], [8250, 6104, 0.39376075834508173, 14], [8448, 6102, 0.3886348900788561, 12], [8712, 6104, 0.38858696255156172, 14], [8603, 6103, 0.38047044025724541, 13], [8718, 1902, 0.37933473945768748, 6], [8078, 9101, 0.37612827026536461, 15], [8313, 6104, 0.36440368407641727, 14], [8261, 12703, 0.36221469388166277, 2], [8259, 12703, 0.36028586082488018, 2], [8612, 12703, 0.35937413277483754, 2], [8611, 12703, 0.35627483233325941, 2], [8611, 9102, 0.35523592468213228, 16], [8715, 6102, 0.35217193444625589, 12], [8081, 12704, 0.35079074602751215, 3], [8256, 12701, 0.35024347473059553, 0], [8947, 3701, 0.34942036752239586, 7], [8252, 9101, 0.34532877154005981, 15], [8252, 12703, 0.34454780518737216, 2], [8258, 12703, 0.33444533897881396, 2], [8449, 12703, 0.33444228033386136, 2], [8140, 6104, 0.33101584433969111, 14], [8138, 6101, 0.32832089131312514, 10], [8595, 1902, 0.32573236786465798, 6], [7815, 12705, 0.32466227232060801, 4], [8143, 12703, 0.32288236586503721, 2], [8255, 12704, 0.32215391411148675, 3], [8138, 1901, 0.31822262838105059, 5], [7495, 12702, 0.31440585696262957, 1], [7975, 1902, 0.31333692320892431, 6], [8552, 6102, 0.31286699241033489, 12], [8156, 12705, 0.31268269817353039, 4], [8612, 1902, 0.31040898848055454, 6], [8987, 9102, 0.30370523955520434, 16], [8082, 9102, 0.30248772208171665, 16], [8274, 12701, 0.30240600075983959, 0], [8335, 12703, 0.30135736187721651, 2], [8461, 12705, 0.30118073359538072, 4], [8588, 12705, 0.30116987331950157, 4], [7815, 6101, 0.29971926932590376, 11], [8249, 12701, 0.29895664066967109, 0], [8259, 12702, 0.29762218230251192, 1], [8948, 3703, 0.2966884328247012, 9], [8084, 12705, 0.2955649285238951, 4], [8149, 6102, 0.29463448700424372, 12], [8262, 3704, 0.29215428934451043, 10], [8987, 6101, 0.28849693471158805, 11], [8719, 12705, 0.28825474040551458, 4], [8453, 9101, 0.28775962926045012, 15], [8946, 6103, 0.2877208426018914, 13], [8455, 9101, 0.28650817876732992, 15], [8464, 6103, 0.28383866792175866, 13], [7957, 6104, 0.28328708127569058, 14], [10001, 3703, 0.27757769906511587, 9], [8439, 6103, 0.27730649502509203, 13], [8138, 12702, 0.27631268432885536, 1], [8553, 12705, 0.27535414410516479, 4], [8597, 12705, 0.26929770166779371, 4], [10001, 12701, 0.26876420003406543, 0], [8720, 12704, 0.26805706392909173, 3], [8341, 6103, 0.26751988374891889, 13], [8320, 9101, 0.26695811307338391, 15], [8263, 12702, 0.26587071251098537, 1], [9042, 12701, 0.26561342054825515, 0], [8081, 9102, 0.26407112735283156, 16], [7443, 6103, 0.26360463667661793, 13], [8980, 9102, 0.26352073659300518, 16], [8261, 12705, 0.26240454340594949, 4], [8724, 12705, 0.25875275593591573, 4], [8950, 12705, 0.2583784990196451, 4], [8942, 6103, 0.25695624416265622, 13], [8141, 12701, 0.25629379652586043, 0], [8084, 3701, 0.25525551019225728, 7], [8454, 9102, 0.25481182567349442, 16], [8147, 12705, 0.25415052014129241, 4], [7991, 6103, 0.25015819178772625, 13], [8555, 12703, 0.24929274436012691, 2], [8934, 12703, 0.24818905251821313, 2], [8258, 12702, 0.24633634351117289, 1], [8262, 3701, 0.24559540344491718, 7], [8485, 6102, 0.24398491242784581, 12], [8455, 1902, 0.24259605582790048, 6], [8257, 12702, 0.2423959267636443, 1], [8611, 6104, 0.24039425327370323, 14], [8257, 12705, 0.23798579083944751, 4], [7975, 12703, 0.23750348280683087, 2], [8341, 12701, 0.23429061295890391, 0], [9049, 9101, 0.23403341841580871, 14], [8551, 12704, 0.23295406001910338, 3], [8948, 12701, 0.23287630982921015, 0], [8567, 6102, 0.23202744014786006, 12], [8135, 12705, 0.23075749678707899, 4], [8255, 12701, 0.2293615230425449, 0], [8728, 9101, 0.22888000181898127, 15], [8547, 12702, 0.22867679893701109, 1], [8081, 12703, 0.22746119341691032, 2], [8466, 12701, 0.22426125076937581, 0], [8717, 12705, 0.22163309208751486, 4], [8078, 12704, 0.22126958546293668, 3], [8262, 12702, 0.22121393196967182, 1], [8086, 3703, 0.21755542382551799, 9], [8254, 12702, 0.21486779168359407, 1], [8456, 12705, 0.21064241069995532, 4], [8726, 12703, 0.20796209161341328, 2], [8439, 9101, 0.20770405917525486, 15], [8987, 6104, 0.20468031961645647, 14], [7962, 12705, 0.20415471120735104, 4], [8464, 12703, 0.20227199120915743, 2], [7960, 12702, 0.20193348145973733, 1], [8553, 9101, 0.20098880010776266, 15]]

jones = [80823702, 80833703, 813712701, 813512705, 81373704, 813712705, 81386103, 814012702,
        814312703, 824912701, 824712705, 82529101, 825312704, 825412702, 825612701, 84486102,
        82579101, 825712702, 845112705, 844812704, 825712705, 846612703, 825912702, 825912703,
        826312702, 834112701, 83176101, 84659101, 833012704, 74953703, 83253702, 832912703, 833512703, 855212702,
        744312704, 855112704, 84853704, 848112702, 848612704, 86036103, 84846101, 79916103, 796212705, 79909101,
        78156101, 861812701, 79753701, 797712704, 85526102, 84839102, 86066101, 86189102]
for i in jones:
    jones[(jones.index(i))] = str(i)


bisz = ['1-339166', '1-43672', '1-339138', '1-44117', '1-44479', '1-605549', '1-216973', '1-137844', '1-138034',
        '1-275456', '1-487452', '1-282144', '1-258777', '1-258988', '1-284197', '1-591474', '1-285031', '1-320642',
        '1-134848', '1-633994', '1-594602', '1-95111', '1-561039', '1-23891', '1-114334']

bisz_c = []

for i in bisz:
    bisz_e = str(i)
    bisz_indx = mangaid.index(bisz_e)
    element = ifu_list[bisz_indx]
    element = element.replace("-","")
    bisz_c.append(element)

#gg with jones
jones_match = []
for i in good_galxies:
    ithname = str(i[0]) + str(i[1])
    match_i = [s for s in jones if ithname in s]
    if len(match_i) != 0:
        jones_match.append(match_i)

#bisz match
bisz_match = []

for i in good_galxies:
    ithname = str(i[0]) + str(i[1])
    match_i = [s for s in bisz_c if ithname in s]
    if len(match_i) != 0:
        bisz_match.append(match_i)

print('Percent of Jones match: ',len(jones_match)/len(jones))
print('Galaxies in common with Jones: \n',jones_match,'\n')
print('Percent of Bizyaev match: ',len(bisz_match)/len(bisz))
print('Galaxies in common with Bizyaev: \n',bisz_match)
